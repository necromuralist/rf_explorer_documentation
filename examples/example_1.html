<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>RF-Explorer Example One &#8212; RF-Explorer Documentation 2017.10.02.a documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2017.10.02.a',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="RF Explorer" href="../rfexplorer/index.html" />
    <link rel="prev" title="Examples" href="index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          RF-Explorer Documentation</a>
        <span class="navbar-text navbar-version pull-left"><b>2017.10.02</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rfexplorer/index.html">RF-Explorer</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">RF-Explorer Example One</a><ul>
<li><a class="reference internal" href="#description">1 Description</a></li>
<li><a class="reference internal" href="#tangle">2 Tangle</a></li>
<li><a class="reference internal" href="#imports">3 Imports</a></li>
<li><a class="reference internal" href="#print-peak">4 Print Peak</a><ul>
<li><a class="reference internal" href="#line-formats">4.1 Line Formats</a></li>
<li><a class="reference internal" href="#get-the-data">4.2 Get The Data</a></li>
<li><a class="reference internal" href="#get-the-peak-data">4.3 Get The Peak Data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-communicator">5 The Communicator</a></li>
<li><a class="reference internal" href="#the-main-processing-loop">6 The Main processing loop</a><ul>
<li><a class="reference internal" href="#get-the-ports">6.1 Get the ports</a></li>
<li><a class="reference internal" href="#connect-to-the-rfexplorer">6.2 Connect to the RFExplorer</a></li>
<li><a class="reference internal" href="#reset-the-device">6.3 Reset The Device</a></li>
<li><a class="reference internal" href="#the-model-and-configuration">6.4 The Model And Configuration</a></li>
<li><a class="reference internal" href="#analyzer-check">6.5 Analyzer Check</a></li>
<li><a class="reference internal" href="#setup-the-loop">6.6 Setup the Loop</a></li>
<li><a class="reference internal" href="#process-string">6.7 Process String</a></li>
<li><a class="reference internal" href="#print-the-data">6.8 Print The Data</a></li>
<li><a class="reference internal" href="#end-main">6.9 End Main</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-argument-parser">7 The Argument Parser</a><ul>
<li><a class="reference internal" href="#serial-port">7.1 Serial Port</a></li>
<li><a class="reference internal" href="#baud-rate">7.2 Baud Rate</a></li>
<li><a class="reference internal" href="#run-time">7.3 Run-Time</a></li>
<li><a class="reference internal" href="#csv-data">7.4 CSV Data</a></li>
<li><a class="reference internal" href="#parse-the-arguments">7.5 Parse the Arguments</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-executable-block">8 The Executable Block</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="index.html" title="Previous Chapter: Examples"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Examples</span>
    </a>
  </li>
  <li>
    <a href="../rfexplorer/index.html" title="Next Chapter: RF Explorer"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">RF Explorer &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/examples/example_1.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="rf-explorer-example-one">
<h1><a class="toc-backref" href="#id1">RF-Explorer Example One</a><a class="headerlink" href="#rf-explorer-example-one" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#rf-explorer-example-one" id="id1">RF-Explorer Example One</a><ul>
<li><a class="reference internal" href="#description" id="id2">1 Description</a></li>
<li><a class="reference internal" href="#tangle" id="id3">2 Tangle</a></li>
<li><a class="reference internal" href="#imports" id="id4">3 Imports</a></li>
<li><a class="reference internal" href="#print-peak" id="id5">4 Print Peak</a><ul>
<li><a class="reference internal" href="#line-formats" id="id6">4.1 Line Formats</a></li>
<li><a class="reference internal" href="#get-the-data" id="id7">4.2 Get The Data</a></li>
<li><a class="reference internal" href="#get-the-peak-data" id="id8">4.3 Get The Peak Data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-communicator" id="id9">5 The Communicator</a></li>
<li><a class="reference internal" href="#the-main-processing-loop" id="id10">6 The Main processing loop</a><ul>
<li><a class="reference internal" href="#get-the-ports" id="id11">6.1 Get the ports</a></li>
<li><a class="reference internal" href="#connect-to-the-rfexplorer" id="id12">6.2 Connect to the RFExplorer</a></li>
<li><a class="reference internal" href="#reset-the-device" id="id13">6.3 Reset The Device</a></li>
<li><a class="reference internal" href="#the-model-and-configuration" id="id14">6.4 The Model And Configuration</a></li>
<li><a class="reference internal" href="#analyzer-check" id="id15">6.5 Analyzer Check</a></li>
<li><a class="reference internal" href="#setup-the-loop" id="id16">6.6 Setup the Loop</a></li>
<li><a class="reference internal" href="#process-string" id="id17">6.7 Process String</a></li>
<li><a class="reference internal" href="#print-the-data" id="id18">6.8 Print The Data</a></li>
<li><a class="reference internal" href="#end-main" id="id19">6.9 End Main</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-argument-parser" id="id20">7 The Argument Parser</a><ul>
<li><a class="reference internal" href="#serial-port" id="id21">7.1 Serial Port</a></li>
<li><a class="reference internal" href="#baud-rate" id="id22">7.2 Baud Rate</a></li>
<li><a class="reference internal" href="#run-time" id="id23">7.3 Run-Time</a></li>
<li><a class="reference internal" href="#csv-data" id="id24">7.4 CSV Data</a></li>
<li><a class="reference internal" href="#parse-the-arguments" id="id25">7.5 Parse the Arguments</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-executable-block" id="id26">8 The Executable Block</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id2">1 Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This is the first example that comes with the <code class="docutils literal"><span class="pre">RFExplorer</span></code> repository.
It will display the amplitude (in dBm) and the frequency (in MHz) of the maximum value in the sweep data.
The amount of stored sweep data is controlled by the length of time that it scans.</p>
</div>
<div class="section" id="tangle">
<h2><a class="toc-backref" href="#id3">2 Tangle</a><a class="headerlink" href="#tangle" title="Permalink to this headline">¶</a></h2>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;&lt;</span><span class="n">imports</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">line</span><span class="o">-</span><span class="n">formats</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="nb">print</span><span class="o">-</span><span class="n">peak</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">get</span><span class="o">-</span><span class="n">data</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">get</span><span class="o">-</span><span class="n">peak</span><span class="o">-</span><span class="n">data</span><span class="o">&gt;&gt;</span>
<span class="o">&lt;&lt;</span><span class="k">global</span><span class="o">-</span><span class="n">variables</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">communicator</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">main</span><span class="o">&gt;&gt;</span>
        <span class="o">&lt;&lt;</span><span class="n">get</span><span class="o">-</span><span class="n">ports</span><span class="o">&gt;&gt;</span>

        <span class="o">&lt;&lt;</span><span class="n">connect</span><span class="o">-</span><span class="n">port</span><span class="o">&gt;&gt;</span>

        <span class="o">&lt;&lt;</span><span class="n">reset</span><span class="o">-</span><span class="n">explorer</span><span class="o">&gt;&gt;</span>

        <span class="o">&lt;&lt;</span><span class="n">get</span><span class="o">-</span><span class="n">model</span><span class="o">&gt;&gt;</span>

        <span class="o">&lt;&lt;</span><span class="n">analyzer</span><span class="o">-</span><span class="n">check</span><span class="o">&gt;&gt;</span>

        <span class="o">&lt;&lt;</span><span class="n">setup</span><span class="o">-</span><span class="n">loop</span><span class="o">&gt;&gt;</span>
            <span class="o">&lt;&lt;</span><span class="n">process</span><span class="o">-</span><span class="n">string</span><span class="o">&gt;&gt;</span>
            <span class="o">&lt;&lt;</span><span class="nb">print</span><span class="o">-</span><span class="n">data</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">end</span><span class="o">-</span><span class="n">main</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">argument</span><span class="o">-</span><span class="n">parser</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">serial</span><span class="o">-</span><span class="n">port</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">baud</span><span class="o">-</span><span class="n">rate</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">run</span><span class="o">-</span><span class="n">time</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">csv</span><span class="o">-</span><span class="n">data</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="k">return</span><span class="o">-</span><span class="n">arguments</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">executable</span><span class="o">-</span><span class="n">block</span><span class="o">&gt;&gt;</span>
    <span class="o">&lt;&lt;</span><span class="n">cleanup</span><span class="o">&gt;&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="imports">
<h2><a class="toc-backref" href="#id4">3 Imports</a><a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h2>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="c1"># python standard library</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="c1"># from pypi</span>
<span class="kn">import</span> <span class="nn">RFExplorer</span>
</pre></div>
</div>
</div>
<div class="section" id="print-peak">
<h2><a class="toc-backref" href="#id5">4 Print Peak</a><a class="headerlink" href="#print-peak" title="Permalink to this headline">¶</a></h2>
<p>This is a helper function to get only the peak data from the sweep and print it to stdout.</p>
<div class="section" id="line-formats">
<h3><a class="toc-backref" href="#id6">4.1 Line Formats</a><a class="headerlink" href="#line-formats" title="Permalink to this headline">¶</a></h3>
<p>These are the output formats for each line.</p>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="n">CSV_LINE</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">,</span><span class="si">{1}</span><span class="s2">,</span><span class="si">{2}</span><span class="s2">&quot;</span>
<span class="n">HUMAN_LINE</span> <span class="o">=</span> <span class="s2">&quot;Sweep[</span><span class="si">{0}</span><span class="s2">]: Peak: </span><span class="si">{1:.3f}</span><span class="s2"> MHz</span><span class="se">\t</span><span class="si">{2}</span><span class="s2"> dBm&quot;</span>
</pre></div>
</div>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">PrintPeak</span><span class="p">(</span><span class="n">rf_explorer</span><span class="p">,</span> <span class="n">csv_data</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function prints the amplitude and frequency peak of the latest received sweep</span>

<span class="sd">    Args:</span>
<span class="sd">     rfe_explorer (`RFExplorer.RFECommunicator`): communicator to get data from</span>
<span class="sd">     csv_data (bool): if True, print as CSV output</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="get-the-data">
<h3><a class="toc-backref" href="#id7">4.2 Get The Data</a><a class="headerlink" href="#get-the-data" title="Permalink to this headline">¶</a></h3>
<p>This gets the current data-count from <a class="reference internal" href="../rfexplorer/autogenerated_api/RFExplorer.RFESweepDataCollection.html#RFExplorer.RFESweepDataCollection.RFESweepDataCollection.Count" title="RFExplorer.RFESweepDataCollection.RFESweepDataCollection.Count"><code class="xref py py-attr docutils literal"><span class="pre">RFExplorer.RFESweepDataCollection.RFESweepDataCollection.Count</span></code></a>, decrements it to get the current index, then gets the data from <a class="reference internal" href="../rfexplorer/autogenerated_api/RFExplorer.RFESweepDataCollection.html#RFExplorer.RFESweepDataCollection.RFESweepDataCollection.GetData" title="RFExplorer.RFESweepDataCollection.RFESweepDataCollection.GetData"><code class="xref py py-meth docutils literal"><span class="pre">RFExplorer.RFESweepDataCollection.RFESweepDataCollection.GetData()</span></code></a>.</p>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="n">rf_explorer</span><span class="o">.</span><span class="n">SweepData</span><span class="o">.</span><span class="n">Count</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">sweep_data</span> <span class="o">=</span> <span class="n">rf_explorer</span><span class="o">.</span><span class="n">SweepData</span><span class="o">.</span><span class="n">GetData</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">sweep_data</span></code> is an instance of <code class="docutils literal"><span class="pre">RFExplorer.RFESweepData.RFESweepData</span></code>.</p>
</div>
<div class="section" id="get-the-peak-data">
<h3><a class="toc-backref" href="#id8">4.3 Get The Peak Data</a><a class="headerlink" href="#get-the-peak-data" title="Permalink to this headline">¶</a></h3>
<p>In this case we aren’t printing all the data, just the peak.</p>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="n">peak_step</span> <span class="o">=</span> <span class="n">sweep_data</span><span class="o">.</span><span class="n">GetPeakStep</span><span class="p">()</span>      <span class="c1">#Get index of the peak</span>
<span class="n">peak_amplitude</span> <span class="o">=</span> <span class="n">sweep_data</span><span class="o">.</span><span class="n">GetAmplitude_DBM</span><span class="p">(</span><span class="n">peak_step</span><span class="p">)</span>    <span class="c1">#Get amplitude of the peak</span>
<span class="n">peak_frequency</span> <span class="o">=</span> <span class="n">sweep_data</span><span class="o">.</span><span class="n">GetFrequencyMHZ</span><span class="p">(</span><span class="n">peak_step</span><span class="p">)</span>   <span class="c1">#Get frequency of the peak</span>

<span class="n">line</span> <span class="o">=</span> <span class="n">CSV_LINE</span> <span class="k">if</span> <span class="n">csv_data</span> <span class="k">else</span> <span class="n">HUMAN_LINE</span>

<span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">peak_frequency</span><span class="p">,</span> <span class="n">peak_amplitude</span><span class="p">))</span>
<span class="k">return</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-communicator">
<h2><a class="toc-backref" href="#id9">5 The Communicator</a><a class="headerlink" href="#the-communicator" title="Permalink to this headline">¶</a></h2>
<p>This is a class to hold the rfe-object to make it easier to close it.</p>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Communicator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;holds the communication object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rfe</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rfe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;RFE Communicator</span>
<span class="sd">        Returns:</span>
<span class="sd">         :py:class:`RFExplorer.RFECommunicator`: the communicator</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rfe</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rfe</span> <span class="o">=</span> <span class="n">RFExplorer</span><span class="o">.</span><span class="n">RFECommunicator</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rfe</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;returns this object&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span>


    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;closes the RFECommunicator&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Closes the RFECommunicator</span>

<span class="sd">        Side-Effect:</span>
<span class="sd">         calls `RFExplorer.RFECommunicator.Close`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rfe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rfe</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rfe</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="section" id="the-main-processing-loop">
<h2><a class="toc-backref" href="#id10">6 The Main processing loop</a><a class="headerlink" href="#the-main-processing-loop" title="Permalink to this headline">¶</a></h2>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">arguments</span><span class="p">,</span> <span class="n">communicator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Runs the example</span>

<span class="sd">    Args:</span>
<span class="sd">     arguments (argparse.Namespace): object with the settings</span>
<span class="sd">     communicator (Communicator): object with the RFECommunicator</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rf_explorer</span> <span class="o">=</span> <span class="n">communicator</span><span class="o">.</span><span class="n">rfe</span>
    <span class="k">try</span><span class="p">:</span>
</pre></div>
</div>
<div class="section" id="get-the-ports">
<h3><a class="toc-backref" href="#id11">6.1 Get the ports</a><a class="headerlink" href="#get-the-ports" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">RFExplorer.RFECommunicator.GetConnectedPorts</span></code> will gather what it thinks are possible ports that the RF-Explorer might be attached to. As a side-effect it will print the ports it found to stdout.</p>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="c1"># get candidate serial ports and print out what you discovered</span>
<span class="n">rf_explorer</span><span class="o">.</span><span class="n">GetConnectedPorts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="connect-to-the-rfexplorer">
<h3><a class="toc-backref" href="#id12">6.2 Connect to the RFExplorer</a><a class="headerlink" href="#connect-to-the-rfexplorer" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">RFExplorer.RFECommunicator.ConnectPort</span></code> will try to connect to the RFExplorer. If <code class="docutils literal"><span class="pre">arguments.serialport</span></code> is <code class="docutils literal"><span class="pre">None</span></code> then it will try each candidate port in order. On my desktop this currently fails (I think because it tries <code class="docutils literal"><span class="pre">/dev/ttyS4</span></code> first) so I have to pass in <code class="docutils literal"><span class="pre">/dev/ttyUSB0</span></code> explicitly to make it work.</p>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="c1">#Connect to available port</span>
<span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">rf_explorer</span><span class="o">.</span><span class="n">ConnectPort</span><span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="n">serialport</span><span class="p">,</span> <span class="n">arguments</span><span class="o">.</span><span class="n">baud_rate</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Not Connected&quot;</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="section" id="reset-the-device">
<h3><a class="toc-backref" href="#id13">6.3 Reset The Device</a><a class="headerlink" href="#reset-the-device" title="Permalink to this headline">¶</a></h3>
<p>This sends the reset command (“r”) using <code class="docutils literal"><span class="pre">RFExplorer.RFECommunicator.SendCommand</span></code>, then waits forever for the <code class="docutils literal"><span class="pre">RFExplorer.RFECommunicator.IsResetEvent</span></code> attribute to change to False. Once the device indicates that it is out of the reset-state it sleeps for three seconds to let things settle down.</p>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="c1">#Reset the unit to start fresh</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sending the Reset Command&quot;</span><span class="p">)</span>
<span class="n">rf_explorer</span><span class="o">.</span><span class="n">SendCommand</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>

<span class="c1">#Wait for unit to notify reset completed</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Waiting until the device resets&quot;</span><span class="p">)</span>
<span class="k">while</span><span class="p">(</span><span class="n">rf_explorer</span><span class="o">.</span><span class="n">IsResetEvent</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="c1">#Wait for unit to stabilize</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reset, sleeping for 3 seconds&quot;</span><span class="p">)</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="the-model-and-configuration">
<h3><a class="toc-backref" href="#id14">6.4 The Model And Configuration</a><a class="headerlink" href="#the-model-and-configuration" title="Permalink to this headline">¶</a></h3>
<p>Most of the methods you want to use assume that the configuration has been set up. This loop makes the request to set it up and then waits forever for the model to be set (waits for <code class="docutils literal"><span class="pre">RFExplorer.RFECommunicator.ActiveModel</span></code> to not equal <code class="docutils literal"><span class="pre">RFExplorer.RFE_Common.eModel.MODEL_NONE</span></code>). The <code class="docutils literal"><span class="pre">RFExplorer</span></code> has to be prompted to process the information that the thread is reading off the serial port so in between checking if the model is set it calls <code class="docutils literal"><span class="pre">RFExplorer.RFECommunicator.ProcessReceivedString</span></code> to tell it to do so.</p>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="c1">#Request RF Explorer configuration</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;requesting the configuration data&quot;</span><span class="p">)</span>
<span class="n">rf_explorer</span><span class="o">.</span><span class="n">SendCommand_RequestConfigData</span><span class="p">()</span>
<span class="c1">#Wait to receive configuration and model details</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Waiting for the model to not be None&quot;</span><span class="p">)</span>
<span class="k">while</span><span class="p">(</span><span class="n">rf_explorer</span><span class="o">.</span><span class="n">ActiveModel</span> <span class="o">==</span> <span class="n">RFExplorer</span><span class="o">.</span><span class="n">RFE_Common</span><span class="o">.</span><span class="n">eModel</span><span class="o">.</span><span class="n">MODEL_NONE</span><span class="p">):</span>
    <span class="n">rf_explorer</span><span class="o">.</span><span class="n">ProcessReceivedString</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>    <span class="c1">#Process the received configuration</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Model is set&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="analyzer-check">
<h3><a class="toc-backref" href="#id15">6.5 Analyzer Check</a><a class="headerlink" href="#analyzer-check" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">RFExplorer</span></code> can talk to both spectrum analyzers and signal generators, but this code will only work with the spectrum analyzer, so use the <code class="docutils literal"><span class="pre">RFExplorer.RFECommunicator.IsAnalyzer</span></code> method to make sure that’s what this is</p>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="c1">#If object is an analyzer, we can scan for received sweeps</span>
<span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">rf_explorer</span><span class="o">.</span><span class="n">IsAnalyzer</span><span class="p">()):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: Device connected is a Signal Generator. &quot;</span>
          <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Please, connect a Spectrum Analyzer&quot;</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="section" id="setup-the-loop">
<h3><a class="toc-backref" href="#id16">6.6 Setup the Loop</a><a class="headerlink" href="#setup-the-loop" title="Permalink to this headline">¶</a></h3>
<p>The loop will run continually until we run out of time. This sets up the time variables as well as a <code class="docutils literal"><span class="pre">last_index</span></code> variable that will make sure that we only print the value if it has been updated.</p>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Receiving data...&quot;</span><span class="p">)</span>
<span class="c1">#Process until we complete scan time</span>
<span class="n">last_index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="n">total</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">arguments</span><span class="o">.</span><span class="n">run_time</span><span class="p">)</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">total</span>

<span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">csv_data</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;index,frequency (MHz), amplitude (dBm)&quot;</span><span class="p">)</span>
<span class="k">while</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">):</span>
</pre></div>
</div>
</div>
<div class="section" id="process-string">
<h3><a class="toc-backref" href="#id17">6.7 Process String</a><a class="headerlink" href="#process-string" title="Permalink to this headline">¶</a></h3>
<p>As before, the thread needs to be prompted to inspect the string it has pulled from the serial port.</p>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="c1">#Process all received data from device</span>
<span class="n">rf_explorer</span><span class="o">.</span><span class="n">ProcessReceivedString</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="print-the-data">
<h3><a class="toc-backref" href="#id18">6.8 Print The Data</a><a class="headerlink" href="#print-the-data" title="Permalink to this headline">¶</a></h3>
<p>This checks the <code class="docutils literal"><span class="pre">RFExplorer.RFECommunicator.SweepData.Count</span></code> to see if it is new data and then, if it is, calls the <code class="docutils literal"><span class="pre">PrintPeak</span></code> function (defined above) to print the data to the screen and then updates the <code class="docutils literal"><span class="pre">last_index</span></code> that we printed.</p>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="c1">#Print data if received new sweep only</span>
<span class="k">if</span> <span class="p">(</span><span class="n">rf_explorer</span><span class="o">.</span><span class="n">SweepData</span><span class="o">.</span><span class="n">Count</span> <span class="o">&gt;</span> <span class="n">last_index</span><span class="p">):</span>
    <span class="n">PrintPeak</span><span class="p">(</span><span class="n">rf_explorer</span><span class="p">,</span> <span class="n">arguments</span><span class="o">.</span><span class="n">csv_data</span><span class="p">)</span>
    <span class="n">last_index</span> <span class="o">=</span> <span class="n">rf_explorer</span><span class="o">.</span><span class="n">SweepData</span><span class="o">.</span><span class="n">Count</span>
</pre></div>
</div>
</div>
<div class="section" id="end-main">
<h3><a class="toc-backref" href="#id19">6.9 End Main</a><a class="headerlink" href="#end-main" title="Permalink to this headline">¶</a></h3>
<p>This is a leftover block to catch any exceptions that get raised.</p>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">obEx</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obEx</span><span class="p">))</span>
<span class="k">return</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-argument-parser">
<h2><a class="toc-backref" href="#id20">7 The Argument Parser</a><a class="headerlink" href="#the-argument-parser" title="Permalink to this headline">¶</a></h2>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">parse_arguments</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="s2">&quot;RF Explorer Example One&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="serial-port">
<h3><a class="toc-backref" href="#id21">7.1 Serial Port</a><a class="headerlink" href="#serial-port" title="Permalink to this headline">¶</a></h3>
<p>If the `RFExplorer.RFECommunicator.ConnectPort` isn’t given a serial port it will try all the likely ports until it does or doesn’t connect. If this doesn’t work then pass in a specific port (e.g. <code class="docutils literal"><span class="pre">/dev/ttyUSB0</span></code>).</p>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s2">&quot;--serialport&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to the serial-port file (e.g. &#39;/dev/ttyUSB0&#39;) - Default=</span><span class="si">%(default)s</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="baud-rate">
<h3><a class="toc-backref" href="#id22">7.2 Baud Rate</a><a class="headerlink" href="#baud-rate" title="Permalink to this headline">¶</a></h3>
<p>The baud-rate should be 500,000. Don’t change it unless you know something changed.</p>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s2">&quot;--baud-rate&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">500000</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Baud-rate for the serial port (default=</span><span class="si">%(default)s</span><span class="s2">)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="run-time">
<h3><a class="toc-backref" href="#id23">7.3 Run-Time</a><a class="headerlink" href="#run-time" title="Permalink to this headline">¶</a></h3>
<p>This is the number of seconds to collect data before quitting.</p>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s2">&quot;--run-time&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Seconds to collect data (default=</span><span class="si">%(default)s</span><span class="s2">)&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="csv-data">
<h3><a class="toc-backref" href="#id24">7.4 CSV Data</a><a class="headerlink" href="#csv-data" title="Permalink to this headline">¶</a></h3>
<p>This tells the code to print a CSV format instead of the usual (human-readable) format.</p>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s2">&quot;--csv-data&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output csv-formatted data&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="parse-the-arguments">
<h3><a class="toc-backref" href="#id25">7.5 Parse the Arguments</a><a class="headerlink" href="#parse-the-arguments" title="Permalink to this headline">¶</a></h3>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-executable-block">
<h2><a class="toc-backref" href="#id26">8 The Executable Block</a><a class="headerlink" href="#the-executable-block" title="Permalink to this headline">¶</a></h2>
<div class="code ipython highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="n">parse_arguments</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">Communicator</span><span class="p">()</span> <span class="k">as</span> <span class="n">communicator</span><span class="p">:</span>
        <span class="n">main</span><span class="p">(</span><span class="n">arguments</span><span class="p">,</span> <span class="n">communicator</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2017, Cloistered Monkey.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>